#!/bin/bash

# –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: command [start|stop|restart|logs|status|update]

# –¶–≤–µ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m'

# –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–º–∞–Ω–¥
COMMAND_NAME="command"
COMMAND_DESCRIPTION="Command - –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏"

# –î–µ—Ñ–æ–ª—Ç–Ω–æ–µ –∏–º—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (–¥–æ–ª–∂–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å DEFAULT_CONTAINER_NAME –≤ core_updater.py)
DEFAULT_CONTAINER_NAME="coreness"

# –ò–º—è Docker –æ–±—Ä–∞–∑–∞
DOCKER_IMAGE="coreness-image"

# –ö—ç—à –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
declare -A CONFIG_CACHE

# –ü—É—Ç–∏ –∫ —Å–∫—Ä–∏–ø—Ç–∞–º –∏ —Ñ–∞–π–ª–∞–º
TOOLS_DIR="tools/core"
DATABASE_MANAGER_SCRIPT="tools/database_manager.py"
CORE_UPDATER_SCRIPT="tools/core/core_updater.py"
DOCKER_COMPOSE_FILE="docker-compose.yml"
DOCKER_DIR="docker"
MAIN_SCRIPT="main.py"

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
CONTAINER_NAME="coreness-service"

# –î–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
DEFAULT_MEMORY_LIMIT=""
DEFAULT_CPU_LIMIT=""

# –®–∞–±–ª–æ–Ω—ã –∫–æ–º–∞–Ω–¥ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∞–ª–∏–∞—Å–æ–≤
# –§–æ—Ä–º–∞—Ç: command-<–∏–º—è_–∫–æ–º–∞–Ω–¥—ã>
ALIASES=("command-start" "command-stop" "command-restart" "command-logs" "command-status" "command-update" "command-db" "command-shell" "command-kill" "command-config")

# =============================================================================
# CONFIG MANAGER - –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π —Å –∫—ç—à–µ–º
# =============================================================================

# –ü–æ–ª—É—á–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
get_config() {
    local key="$1"
    local default_value="${2:-}"
    
    # –ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ —É–∂–µ –≤ –∫—ç—à–µ - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –µ–≥–æ
    if [ -n "${CONFIG_CACHE[$key]:-}" ]; then
        echo "${CONFIG_CACHE[$key]}"
        return 0
    fi
    
    # –í—ã—á–∏—Å–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–ª—é—á–∞
    local computed_value=""
    case "$key" in
        "command_name")
            # –ò–º—è –∫–æ–º–∞–Ω–¥—ã - –≤—Å–µ–≥–¥–∞ –∏–º—è —Å–∫—Ä–∏–ø—Ç–∞ (–¥–ª—è UI, –∞–ª–∏–∞—Å–æ–≤, —É—Å—Ç–∞–Ω–æ–≤–∫–∏)
            computed_value=$(basename "$0")
            ;;
        "container_name")
            # –ò–º—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ - –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ –∏–º–µ–Ω–∏ –∫–æ–º–∞–Ω–¥—ã (–¥–ª—è Docker –æ–ø–µ—Ä–∞—Ü–∏–π)
            local script_basename=$(basename "$0")
            if [ "$script_basename" != "command" ]; then
                # –ï—Å–ª–∏ –∫–æ–º–∞–Ω–¥–∞ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –¥–µ—Ñ–æ–ª—Ç–Ω–æ–π - –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏–º—è –∫–æ–º–∞–Ω–¥—ã
                computed_value="$script_basename"
            else
                # –ï—Å–ª–∏ –∫–æ–º–∞–Ω–¥–∞ –¥–µ—Ñ–æ–ª—Ç–Ω–∞—è - –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω–æ–µ –∏–º—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
                computed_value="$(get_default_container_name)"
            fi
            ;;
        "docker_image")
            # –ü—ã—Ç–∞–µ–º—Å—è –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –æ–±—Ä–∞–∑ –∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
            local container_name=$(get_config "container_name")
            if docker ps -a --filter "name=$container_name" | grep -q "$container_name" 2>/dev/null; then
                computed_value=$(docker inspect $container_name --format='{{.Config.Image}}' 2>/dev/null)
            fi
            # –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å - –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ—Ñ–æ–ª—Ç
            if [ -z "$computed_value" ]; then
                computed_value="$(get_docker_image_default)"
            fi
            ;;
        "project_dir")
            # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—É—Ç—å –∫ –ø—Ä–æ–µ–∫—Ç—É –Ω–∞–ø—Ä—è–º—É—é
            computed_value=""
            
            # –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø—É—Ç—å —á–µ—Ä–µ–∑ volume —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
            local container_name=$(get_config "container_name")
            if docker ps -a --filter "name=$container_name" | grep -q "$container_name" 2>/dev/null; then
                computed_value=$(docker inspect $container_name 2>/dev/null | jq -r '.[0].Mounts[] | select(.Destination=="/workspace") | .Source' 2>/dev/null)
                if [ -n "$computed_value" ] && [ -d "$computed_value" ]; then
                    # –ü—É—Ç—å –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ volume
                    :
                else
                    computed_value=""
                fi
            fi
            
            # –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ volume, –∏—â–µ–º –ø–æ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ
            if [ -z "$computed_value" ]; then
                # –ò—â–µ–º –≤ —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∏ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏—Ö
                local current_dir="$(pwd)"
                while [ "$current_dir" != "/" ]; do
                    if [ -f "$current_dir/$(get_docker_dir)/Dockerfile" ]; then
                        computed_value="$current_dir"
                        break
                    fi
                    current_dir="$(dirname "$current_dir")"
                done
                
                # –ò—â–µ–º –≤ /opt
                if [ -z "$computed_value" ] && [ -d "/opt" ]; then
                    for dir in /opt/*; do
                        if [ -d "$dir" ] && [ -f "$dir/$(get_docker_dir)/Dockerfile" ]; then
                            computed_value="$dir"
                            break
                        fi
                    done
                fi
            fi
            
            # –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω - –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ—Ñ–æ–ª—Ç
            if [ -z "$computed_value" ]; then
                computed_value="$default_value"
            fi
            ;;
        "env_file")
            # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—É—Ç—å –∫ .env —Ñ–∞–π–ª—É
            local project_dir
            project_dir=$(get_config "project_dir")
            if [ -n "$project_dir" ] && [ -f "$project_dir/.env" ]; then
                computed_value="$project_dir/.env"
            else
                computed_value=""
            fi
            ;;
        "memory_limit")
            computed_value="${CONFIG_CACHE[memory_limit]:-$DEFAULT_MEMORY_LIMIT}"
            ;;
        "cpu_limit")
            computed_value="${CONFIG_CACHE[cpu_limit]:-$DEFAULT_CPU_LIMIT}"
            ;;
        "command_description")
            computed_value="$COMMAND_DESCRIPTION"
            ;;
        "default_container_name")
            computed_value="$DEFAULT_CONTAINER_NAME"
            ;;
        "docker_image_default")
            computed_value="$DOCKER_IMAGE"
            ;;
        "tools_dir")
            computed_value="$TOOLS_DIR"
            ;;
        "database_manager_script")
            computed_value="$DATABASE_MANAGER_SCRIPT"
            ;;
        "core_updater_script")
            computed_value="$CORE_UPDATER_SCRIPT"
            ;;
        "docker_compose_file")
            computed_value="$DOCKER_COMPOSE_FILE"
            ;;
        "docker_dir")
            computed_value="$DOCKER_DIR"
            ;;
        "main_script")
            computed_value="$MAIN_SCRIPT"
            ;;
        "container_name_default")
            computed_value="$CONTAINER_NAME"
            ;;
        *)
            # –î–ª—è –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∫–ª—é—á–µ–π –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –¥–µ—Ñ–æ–ª—Ç
            computed_value="$default_value"
            ;;
    esac
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫—ç—à –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º
    CONFIG_CACHE[$key]="$computed_value"
    echo "$computed_value"
}

# –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (–ø–æ–ª–µ–∑–Ω–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫)
clear_config_cache() {
    CONFIG_CACHE=()
}

# –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –∫—ç—à–µ
update_config_cache() {
    local key="$1"
    local value="$2"
    CONFIG_CACHE[$key]="$value"
    
    # –ï—Å–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ - —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ —Ñ–∞–π–ª
    if [ "$key" = "memory_limit" ] || [ "$key" = "cpu_limit" ]; then
        save_config_to_file
    fi
}

# –ü–æ–ª—É—á–∏—Ç—å –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞
get_config_file_path() {
    local container_name=$(get_container_name)
    echo "$HOME/.${container_name}_config"
}

# –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–∑ —Ñ–∞–π–ª–∞
load_config_from_file() {
    local config_file=$(get_config_file_path)
    if [ -f "$config_file" ]; then
        # –ß–∏—Ç–∞–µ–º —Ñ–∞–π–ª –∏ —Å—Ä–∞–∑—É —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫—ç—à
        while IFS='=' read -r key value; do
            # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏
            if [[ "$key" =~ ^[[:space:]]*# ]] || [[ -z "$key" ]]; then
                continue
            fi
            
            case "$key" in
                "MEMORY_LIMIT")
                    CONFIG_CACHE[memory_limit]="$value"
                    ;;
                "CPU_LIMIT")
                    CONFIG_CACHE[cpu_limit]="$value"
                    ;;
            esac
        done < "$config_file"
        
        echo "‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–∑ $config_file"
    else
        echo "‚ÑπÔ∏è –§–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ $config_file –Ω–µ –Ω–∞–π–¥–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é"
    fi
}

# –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ —Ñ–∞–π–ª
save_config_to_file() {
    local config_file=$(get_config_file_path)
    local container_name=$(get_container_name)
    
    # –°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –Ω–∞–ø—Ä—è–º—É—é –∏–∑ –∫—ç—à–∞
    cat > "$config_file" << EOF
# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ $container_name
# –°–æ–∑–¥–∞–Ω–æ: $(date)
MEMORY_LIMIT="${CONFIG_CACHE[memory_limit]:-$DEFAULT_MEMORY_LIMIT}"
CPU_LIMIT="${CONFIG_CACHE[cpu_limit]:-$DEFAULT_CPU_LIMIT}"
EOF
    
    echo "‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ $config_file"
}

# –£–¥–æ–±–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏-–æ–±–µ—Ä—Ç–∫–∏ –¥–ª—è —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
get_command_name() { get_config "command_name"; }
get_container_name() { get_config "container_name"; }
get_docker_image() { get_config "docker_image"; }
get_project_dir() { get_config "project_dir"; }
get_env_file() { get_config "env_file"; }
get_memory_limit() { get_config "memory_limit"; }
get_cpu_limit() { get_config "cpu_limit"; }
get_command_description() { get_config "command_description"; }
get_default_container_name() { get_config "default_container_name"; }
get_docker_image_default() { get_config "docker_image_default"; }
get_tools_dir() { get_config "tools_dir"; }
get_database_manager_script() { get_config "database_manager_script"; }
get_core_updater_script() { get_config "core_updater_script"; }
get_docker_compose_file() { get_config "docker_compose_file"; }
get_docker_dir() { get_config "docker_dir"; }
get_main_script() { get_config "main_script"; }
get_container_name_default() { get_config "container_name_default"; }

# –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å—é —Ç–µ–∫—É—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
show_config() {
    echo -e "${BLUE}üìã –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:${NC}"
    echo -e "   –ö–æ–º–∞–Ω–¥–∞: $(get_config 'command_name' '–Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞')"
    echo -e "   –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä: $(get_config 'container_name' '–Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω')"
    echo -e "   –û–±—Ä–∞–∑: $(get_config 'docker_image' '–Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω')"
    echo -e "   –ü—Ä–æ–µ–∫—Ç: $(get_config 'project_dir' '–Ω–µ –Ω–∞–π–¥–µ–Ω')"
    echo -e "   .env —Ñ–∞–π–ª: $(get_config 'env_file' '–Ω–µ –Ω–∞–π–¥–µ–Ω')"
    echo -e "   –õ–∏–º–∏—Ç –ø–∞–º—è—Ç–∏: $(get_config 'memory_limit' '–±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π')"
    echo -e "   –õ–∏–º–∏—Ç CPU: $(get_config 'cpu_limit' '–±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π')"
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ Docker
check_docker() {
    if ! command -v docker &> /dev/null; then
        echo -e "${RED}‚ùå Docker –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!${NC}"
        exit 1
    fi
    
    if ! docker info &> /dev/null; then
        echo -e "${RED}‚ùå Docker –Ω–µ –∑–∞–ø—É—â–µ–Ω!${NC}"
        exit 1
    fi
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
ensure_project_dir() {
    local project_dir=$(get_project_dir)
    if [ -z "$project_dir" ]; then
        echo -e "${RED}‚ùå –ü—Ä–æ–µ–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω!${NC}"
        exit 1
    fi
    cd "$project_dir"
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è docker compose –∫–æ–º–∞–Ω–¥
docker_compose() {
    docker compose -f docker/docker-compose.yml "$@"
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
ensure_container_running() {
    local container_name=$(get_container_name)
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (–ª—é–±–æ–π —Å—Ç–∞—Ç—É—Å)
    if ! docker ps -a --filter "name=$container_name" | grep -q "$container_name"; then
        echo -e "${YELLOW}‚ö†Ô∏è –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω, —Å–æ–∑–¥–∞—é...${NC}"
        run_container_with_config "–°–æ–∑–¥–∞–Ω–∏–µ"
    elif ! docker ps --filter "name=$container_name" --filter "status=running" | grep -q "$container_name"; then
        echo -e "${YELLOW}‚ö†Ô∏è –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –∑–∞–ø—É—Å–∫–∞—é...${NC}"
        docker start "$container_name"
        echo -e "${GREEN}‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—â–µ–Ω${NC}"
    fi
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∫–æ–º–∞–Ω–¥
install_commands() {
    local container_name="$1"  # –ü–æ–ª—É—á–∞–µ–º –∏–º—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∫–∞–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä
    
    # –ï—Å–ª–∏ –∏–º—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–æ, –æ–ø—Ä–µ–¥–µ–ª—è–µ–º —á–µ—Ä–µ–∑ ConfigManager
    if [ -z "$container_name" ]; then
        container_name=$(get_container_name)
    fi

    # –ù–∏–∫–∞–∫–∏—Ö —Ä—É—á–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –Ω–µ –Ω—É–∂–Ω–æ!
    
    echo -e "${BLUE}================================${NC}"
    echo -e "${BLUE}   –£–°–¢–ê–ù–û–í–ö–ê –ì–õ–û–ë–ê–õ–¨–ù–´–• –ö–û–ú–ê–ù–î  ${NC}"
    echo -e "${BLUE}================================${NC}"
    echo -e "${BLUE}   –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä: $container_name   ${NC}"
    echo -e "${BLUE}================================${NC}"
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞
    if [ "$EUID" -eq 0 ]; then
        echo -e "${YELLOW}‚ö†Ô∏è –ó–∞–ø—É—Å–∫ –æ—Ç root. –ö–æ–º–∞–Ω–¥—ã –±—É–¥—É—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≥–ª–æ–±–∞–ª—å–Ω–æ.${NC}"
        INSTALL_DIR="/usr/local/bin"
    else
        echo -e "${YELLOW}‚ö†Ô∏è –ó–∞–ø—É—Å–∫ –æ—Ç –æ–±—ã—á–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ö–æ–º–∞–Ω–¥—ã –±—É–¥—É—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ.${NC}"
        INSTALL_DIR="$HOME/.local/bin"
        
        # –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
        mkdir -p "$INSTALL_DIR"
        
        # –î–æ–±–∞–≤–ª—è–µ–º –≤ PATH –µ—Å–ª–∏ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω
        if ! echo "$PATH" | grep -q "$INSTALL_DIR"; then
            echo -e "${YELLOW}üí° –î–æ–±–∞–≤–ª—è–µ–º $INSTALL_DIR –≤ PATH...${NC}"
            echo "export PATH=\"\$PATH:$INSTALL_DIR\"" >> "$HOME/.bashrc"
            echo "export PATH=\"\$PATH:$INSTALL_DIR\"" >> "$HOME/.profile"
            echo -e "${GREEN}‚úÖ PATH –æ–±–Ω–æ–≤–ª–µ–Ω. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Ä–º–∏–Ω–∞–ª –∏–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ: source ~/.bashrc${NC}"
        fi
    fi
    
    # –ü–æ–ª—É—á–∞–µ–º –ø—É—Ç—å –∫ –∏—Å—Ö–æ–¥–Ω–æ–º—É —Å–∫—Ä–∏–ø—Ç—É
    # –ï—Å–ª–∏ –º—ã –∑–∞–ø—É—â–µ–Ω—ã –∏–∑ /usr/local/bin, –∏—â–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –≤ docker/
    if [ "$(dirname "${BASH_SOURCE[0]}")" = "/usr/local/bin" ]; then
        # –ò—â–µ–º –ø—Ä–æ–µ–∫—Ç —á–µ—Ä–µ–∑ ConfigManager
        local project_dir=$(get_project_dir)
        if [ -n "$project_dir" ]; then
            SCRIPT_PATH="$project_dir/docker/command"
        else
            echo -e "${RED}‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –∏—Å—Ö–æ–¥–Ω—ã–π —Å–∫—Ä–∏–ø—Ç command${NC}"
            exit 1
        fi
    else
        # –ï—Å–ª–∏ –∑–∞–ø—É—â–µ–Ω—ã –∏–∑ docker/, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—É—â–∏–π —Å–∫—Ä–∏–ø—Ç
        SCRIPT_PATH="${BASH_SOURCE[0]}"
    fi
    
    # –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—É—é –∫–æ–º–∞–Ω–¥—É –µ—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
    if [ -f "$INSTALL_DIR/$container_name" ]; then
        echo -e "${YELLOW}üîÑ –û–±–Ω–æ–≤–ª—è—é —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∫–æ–º–∞–Ω–¥—É...${NC}"
        rm "$INSTALL_DIR/$container_name"
    fi
    
    # –ö–æ–ø–∏—Ä—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç
    if cp "$SCRIPT_PATH" "$INSTALL_DIR/$container_name"; then
        chmod +x "$INSTALL_DIR/$container_name"
        
        echo -e "${GREEN}‚úÖ –ö–æ–º–∞–Ω–¥–∞ '$container_name' —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞${NC}"
    else
        echo -e "${RED}‚ùå –û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∫–æ–º–∞–Ω–¥—ã '$container_name'${NC}"
        exit 1
    fi
    
    # –°–æ–∑–¥–∞–µ–º –∞–ª–∏–∞—Å—ã
    create_aliases
    
    echo -e "${GREEN}üéâ –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã!${NC}"
    echo ""
    echo -e "${BLUE}–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:${NC}"
    show_available_commands "$container_name"
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∞–ª–∏–∞—Å–æ–≤
create_aliases() {
    local container_name=$(get_container_name)
    echo -e "${YELLOW}üîó –°–æ–∑–¥–∞–Ω–∏–µ –∞–ª–∏–∞—Å–æ–≤ –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ '$container_name'...${NC}"
    
    # –°–æ–∑–¥–∞–µ–º –∞–ª–∏–∞—Å—ã –≤ .bashrc
    ALIAS_FILE="$HOME/.bashrc"
    
    # –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –∞–ª–∏–∞—Å—ã –¥–ª—è —ç—Ç–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –µ—Å–ª–∏ –µ—Å—Ç—å
    if grep -q "# $container_name aliases" "$ALIAS_FILE" 2>/dev/null; then
        echo -e "${YELLOW}üîÑ –û–±–Ω–æ–≤–ª—è—é —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∞–ª–∏–∞—Å—ã...${NC}"
        # –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –∞–ª–∏–∞—Å—ã (–æ—Ç –Ω–∞—á–∞–ª–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –∏–ª–∏ –∫–æ–Ω—Ü–∞ —Ñ–∞–π–ª–∞)
        sed -i "/# $container_name aliases/,/^# [^$container_name]/{ /# $container_name aliases/d; /^# [^$container_name]/!d; }" "$ALIAS_FILE" 2>/dev/null || true
    fi
    
    # –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –∞–ª–∏–∞—Å—ã
    echo "" >> "$ALIAS_FILE"
    echo "# $container_name aliases" >> "$ALIAS_FILE"
    
    # –°–æ–∑–¥–∞–µ–º –∞–ª–∏–∞—Å—ã –∏–∑ –º–∞—Å—Å–∏–≤–∞
    for alias in "${ALIASES[@]}"; do
        # –ò–∑–≤–ª–µ–∫–∞–µ–º –∫–æ–º–∞–Ω–¥—É –∏–∑ –∞–ª–∏–∞—Å–∞ (—É–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å command-)
        command="${alias#command-}"
        # –°–æ–∑–¥–∞–µ–º –∞–ª–∏–∞—Å —Å –∏–º–µ–Ω–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
        new_alias="${container_name}-${command}"
        echo "alias $new_alias='$container_name $command'" >> "$ALIAS_FILE"
    done
    
    echo -e "${GREEN}‚úÖ –ê–ª–∏–∞—Å—ã –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ '$container_name' —Å–æ–∑–¥–∞–Ω—ã${NC}"
    echo -e "${CYAN}üí° –î–æ—Å—Ç—É–ø–Ω—ã–µ –∞–ª–∏–∞—Å—ã: ${container_name}-start, ${container_name}-stop, ${container_name}-restart, –∏ —Ç.–¥.${NC}"
}

# –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å —Ç–µ–∫—É—â–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
run_container_with_config() {
    local action="$1"  # start, restart, –∏–ª–∏ –¥—Ä—É–≥–∏–µ –¥–µ–π—Å—Ç–≤–∏—è
    
    echo -e "${YELLOW}üöÄ $action –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞...${NC}"
    
    # –ü–æ–ª—É—á–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ ConfigManager
    local project_dir=$(get_project_dir)
    local env_file=$(get_env_file)
    local memory_limit=$(get_memory_limit)
    local cpu_limit=$(get_cpu_limit)
    local docker_image=$(get_docker_image)
    local container_name=$(get_container_name)
    
    if [ -z "$project_dir" ]; then
        echo -e "${RED}‚ùå –ü—Ä–æ–µ–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω!${NC}"
        echo -e "${YELLOW}üí° –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –≤ –ø–∞–ø–∫–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é COMMAND_PROJECT_DIR${NC}"
        exit 1
    fi
    
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –µ—Å–ª–∏ –µ—Å—Ç—å
    if [ -n "$memory_limit" ] || [ -n "$cpu_limit" ]; then
        echo -e "${BLUE}üîß –ü—Ä–∏–º–µ–Ω—è–µ–º—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:${NC}"
        if [ -n "$memory_limit" ]; then
            echo -e "   –õ–∏–º–∏—Ç –ø–∞–º—è—Ç–∏: $memory_limit"
        fi
        if [ -n "$cpu_limit" ]; then
            echo -e "   –õ–∏–º–∏—Ç CPU: $cpu_limit"
        fi
    fi
    
    # –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –µ—Å–ª–∏ –µ—Å—Ç—å
    if docker ps --filter "name=$container_name" | grep -q "$container_name"; then
        echo -e "${YELLOW}üõë –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä...${NC}"
        docker stop $container_name
        docker rm $container_name
    fi
    
    # –°–æ–±–∏—Ä–∞–µ–º –∫–æ–º–∞–Ω–¥—É –∑–∞–ø—É—Å–∫–∞
    local cmd=("docker" "run" "-d" "--name" "$container_name")
    
    # –î–æ–±–∞–≤–ª—è–µ–º –ª–∏–º–∏—Ç—ã –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω—ã
    if [ -n "$memory_limit" ]; then
        cmd+=("-m" "$memory_limit")
    fi
    if [ -n "$cpu_limit" ]; then
        cmd+=("--cpus" "$cpu_limit")
    fi
    
    # –î–æ–±–∞–≤–ª—è–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ–º .env –µ—Å–ª–∏ –µ—Å—Ç—å
    if [ -n "$env_file" ]; then
        cmd+=("--env-file" "$env_file")
        echo -e "${GREEN}‚úÖ –ù–∞–π–¥–µ–Ω .env —Ñ–∞–π–ª, –∑–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è${NC}"
    else
        echo -e "${YELLOW}‚ö†Ô∏è .env —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω, –∑–∞–ø—É—Å–∫–∞–µ–º –±–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è${NC}"
    fi
    
    cmd+=("-v" "$project_dir:/workspace")
    cmd+=("$docker_image")
    cmd+=("tail" "-f" "/dev/null")
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
    if "${cmd[@]}"; then
        echo -e "${GREEN}‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä $action —Å —Ç–µ–∫—É—â–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏${NC}"
        echo -e "${YELLOW}üí° –î–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ: $container_name app-start${NC}"
    else
        echo -e "${RED}‚ùå –û—à–∏–±–∫–∞ $action –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞${NC}"
        exit 1
    fi
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
start_service() {
    ensure_container_running
}

# –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
stop_service() {
    local container_name=$(get_container_name)
    echo -e "${YELLOW}üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞...${NC}"
    
    if docker stop $container_name; then
        echo -e "${GREEN}‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω${NC}"
    else
        echo -e "${RED}‚ùå –û—à–∏–±–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞${NC}"
        exit 1
    fi
}

# –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
restart_service() {
    run_container_with_config "–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫"
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
start_app() {
    local container_name=$(get_container_name)
    echo -e "${YELLOW}üì± –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ...${NC}"
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—â–µ–Ω
    ensure_container_running
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É–∂–µ
    if docker exec $container_name pgrep -f "python3 $(get_main_script)" > /dev/null; then
        echo -e "${GREEN}‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç${NC}"
    else
        # –ó–∞–ø—É—Å–∫–∞–µ–º main.py
        if docker exec -d $container_name python3 $(get_main_script); then
            echo -e "${GREEN}‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ${NC}"
        else
            echo -e "${RED}‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è${NC}"
            echo -e "${YELLOW}üí° –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: $container_name logs${NC}"
            exit 1
        fi
    fi
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
stop_app() {
    local container_name=$(get_container_name)
    echo -e "${YELLOW}üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ...${NC}"
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—â–µ–Ω
    if ! docker ps --filter "name=$container_name" --filter "status=running" | grep -q "$container_name"; then
        echo -e "${RED}‚ùå –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω!${NC}"
        exit 1
    fi
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –ø—Ä–æ—Ü–µ—Å—Å—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    PROCESSES=$(docker exec $container_name pgrep -f "python3 $(get_main_script)")
    if [ -z "$PROCESSES" ]; then
        echo -e "${YELLOW}‚ö†Ô∏è –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–ø—É—â–µ–Ω–æ${NC}"
        return 0
    fi
    
    echo -e "${YELLOW}üìã –ù–∞–π–¥–µ–Ω—ã –ø—Ä–æ—Ü–µ—Å—Å—ã: $PROCESSES${NC}"
    
    # –°–Ω–∞—á–∞–ª–∞ –ø—ã—Ç–∞–µ–º—Å—è –º—è–≥–∫–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å (SIGTERM)
    echo -e "${YELLOW}üîÑ –û—Ç–ø—Ä–∞–≤–∫–∞ SIGTERM...${NC}"
    docker exec $container_name pkill -f "python3 $(get_main_script)"
    
    # –ñ–¥–µ–º 3 —Å–µ–∫—É–Ω–¥—ã
    sleep 3
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –æ—Å—Ç–∞–Ω–æ–≤–∏–ª–∏—Å—å –ª–∏ –ø—Ä–æ—Ü–µ—Å—Å—ã
    REMAINING=$(docker exec $container_name pgrep -f "python3 $(get_main_script)")
    if [ -n "$REMAINING" ]; then
        echo -e "${YELLOW}‚ö†Ô∏è –ü—Ä–æ—Ü–µ—Å—Å—ã –Ω–µ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª–∏—Å—å, –æ—Ç–ø—Ä–∞–≤–∫–∞ SIGKILL...${NC}"
        docker exec $container_name pkill -9 -f "python3 $(get_main_script)"
        sleep 1
    fi
    
    # –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
    FINAL_CHECK=$(docker exec $container_name pgrep -f "python3 $(get_main_script)")
    if [ -z "$FINAL_CHECK" ]; then
        echo -e "${GREEN}‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ${NC}"
    else
        echo -e "${RED}‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ${NC}"
        echo -e "${YELLOW}üí° –û—Å—Ç–∞–≤—à–∏–µ—Å—è –ø—Ä–æ—Ü–µ—Å—Å—ã: $FINAL_CHECK${NC}"
        exit 1
    fi
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
restart_app() {
    local container_name=$(get_container_name)
    echo -e "${YELLOW}üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ...${NC}"
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—â–µ–Ω
    if ! docker ps --filter "name=$container_name" --filter "status=running" | grep -q "$container_name"; then
        echo -e "${YELLOW}‚ö†Ô∏è –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω, –∑–∞–ø—É—Å–∫–∞—é...${NC}"
        run_container_with_config "–ó–∞–ø—É—Å–∫"
    fi
    
    # –£–±–∏–≤–∞–µ–º –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã main.py –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
    echo -e "${YELLOW}üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...${NC}"
    docker exec $container_name pkill -f "python3 $(get_main_script)" 2>/dev/null || true
    
    # –ñ–¥–µ–º –Ω–µ–º–Ω–æ–≥–æ, —á—Ç–æ–±—ã –ø—Ä–æ—Ü–µ—Å—Å—ã –∑–∞–≤–µ—Ä—à–∏–ª–∏—Å—å
    sleep 2
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º main.py –∑–∞–Ω–æ–≤–æ
    echo -e "${YELLOW}üì± –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...${NC}"
    if docker exec -d $container_name python3 $(get_main_script); then
        echo -e "${GREEN}‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω–æ${NC}"
    else
        echo -e "${RED}‚ùå –û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è${NC}"
        echo -e "${YELLOW}üí° –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: $container_name logs${NC}"
        exit 1
    fi
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (—Ñ–∞–π–ª)
show_app_logs() {
    local container_name=$(get_container_name)
    echo -e "${YELLOW}üìã –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...${NC}"
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—â–µ–Ω
    if ! docker ps --filter "name=$container_name" --filter "status=running" | grep -q "$container_name"; then
        echo -e "${YELLOW}‚ö†Ô∏è –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω, –∑–∞–ø—É—Å–∫–∞—é...${NC}"
        run_container_with_config "–ó–∞–ø—É—Å–∫"
    fi
    
    # –ü–æ–ª—É—á–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10)
    local lines=${1:-10}
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ —á–∏—Å–ª–æ
    if ! [[ "$lines" =~ ^[0-9]+$ ]]; then
        echo -e "${RED}‚ùå –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —á–∏—Å–ª–æ–º!${NC}"
        echo -e "${YELLOW}üí° –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: $container_name app-logs [–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_—Å—Ç—Ä–æ–∫]${NC}"
        exit 1
    fi
    
    echo -e "${YELLOW}üìã –ü–æ–∫–∞–∑—ã–≤–∞—é –ø–æ—Å–ª–µ–¥–Ω–∏–µ $lines —Å—Ç—Ä–æ–∫ –ª–æ–≥–æ–≤...${NC}"
    
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏–∑ —Ñ–∞–π–ª–∞
    docker exec $container_name tail -f -n $lines /workspace/logs/bot.log
}

# –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
show_logs() {
    local container_name=$(get_container_name)
    docker logs -f $container_name
}

# –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞
show_status() {
    local container_name=$(get_container_name)
    echo -e "${BLUE}üìä –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:${NC}"
    docker ps --filter "name=$container_name"
    
    echo -e "\n${BLUE}üì± –°—Ç–∞—Ç—É—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:${NC}"
    if docker exec $container_name pgrep -f "python3 $(get_main_script)" > /dev/null 2>&1; then
        # –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–æ—Ü–µ—Å—Å–µ
        PROCESS_INFO=$(docker exec $container_name ps aux | grep "python3 $(get_main_script)" | grep -v grep)
        if [ -n "$PROCESS_INFO" ]; then
            PID=$(echo "$PROCESS_INFO" | awk '{print $2}')
            CPU=$(echo "$PROCESS_INFO" | awk '{print $3}')
            MEM=$(echo "$PROCESS_INFO" | awk '{print $4}')
            TIME=$(echo "$PROCESS_INFO" | awk '{print $10}')
            echo -e "${GREEN}‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç${NC}"
            echo -e "   PID: $PID | CPU: $CPU% | MEM: $MEM% | TIME: $TIME"
        else
            echo -e "${YELLOW}‚ö†Ô∏è –ü—Ä–æ—Ü–µ—Å—Å –Ω–∞–π–¥–µ–Ω, –Ω–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞${NC}"
        fi
    else
        echo -e "${RED}‚ùå –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–ø—É—â–µ–Ω–æ${NC}"
        echo -e "${YELLOW}üí° –ó–∞–ø—É—Å—Ç–∏—Ç–µ: $container_name start${NC}"
    fi
    
    echo -e "\n${BLUE}üìà –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:${NC}"
    docker stats --no-stream $container_name 2>/dev/null || echo "–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω"
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î
manage_app_database() {
    local container_name=$(get_container_name)
    echo -e "${YELLOW}üóÑ –†–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö...${NC}"
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—â–µ–Ω
    if ! docker ps --filter "name=$container_name" --filter "status=running" | grep -q "$container_name"; then
        echo -e "${YELLOW}‚ö†Ô∏è –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω, –∑–∞–ø—É—Å–∫–∞—é...${NC}"
        run_container_with_config "–ó–∞–ø—É—Å–∫"
    fi
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º database_manager.py —Å –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
    shift  # –£–±–∏—Ä–∞–µ–º –ø–µ—Ä–≤—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç (app-db)
    docker exec $container_name python3 $(get_database_manager_script) "$@"
}

# –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ shell –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
open_shell() {
    local container_name=$(get_container_name)
    echo -e "${YELLOW}üêö –ó–∞–ø—É—Å–∫ shell –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ...${NC}"
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—â–µ–Ω
    ensure_container_running
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º bash –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
    docker exec -it $container_name bash
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
update_app() {
    echo -e "${YELLOW}üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ $(get_command_description)...${NC}"
    
    # –î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Å–µ-—Ç–∞–∫–∏ –Ω—É–∂–µ–Ω –¥–æ—Å—Ç—É–ø –∫ —Ñ–∞–π–ª–∞–º –ø—Ä–æ–µ–∫—Ç–∞
    local project_dir=$(get_project_dir)
    if [ -z "$project_dir" ]; then
        echo -e "${RED}‚ùå –ü—Ä–æ–µ–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω!${NC}"
        echo -e "${YELLOW}üí° –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –≤ –ø–∞–ø–∫–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é COMMAND_PROJECT_DIR${NC}"
        exit 1
    fi
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º core_updater.py
    python3 "$project_dir/$(get_core_updater_script)"
}

# –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫
set_container_config() {
    local container_name=$(get_container_name)
    # –£–±–∏—Ä–∞–µ–º –ø–µ—Ä–≤—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç (config)
    shift
    
    # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤—Å–µ –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    while [ $# -gt 0 ]; do
        local param="$1"
        shift
        
        case "$param" in
            "memory")
                if [ $# -eq 0 ]; then
                    echo -e "${RED}‚ùå –£–∫–∞–∂–∏—Ç–µ –ª–∏–º–∏—Ç –ø–∞–º—è—Ç–∏!${NC}"
                    echo -e "${YELLOW}üí° –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: $container_name config memory 512m${NC}"
                    exit 1
                fi
                
                local value="$1"
                shift
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–∞—Ç –ø–∞–º—è—Ç–∏
                if ! [[ "$value" =~ ^[0-9]+[mg]?$ ]]; then
                    echo -e "${RED}‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –ø–∞–º—è—Ç–∏!${NC}"
                    echo -e "${YELLOW}üí° –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: 512m, 1g, 2g${NC}"
                    exit 1
                fi
                
                update_config_cache "memory_limit" "$value"  # –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –∫—ç—à–µ
                echo -e "${GREEN}‚úÖ –õ–∏–º–∏—Ç –ø–∞–º—è—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: $value${NC}"
                ;;
                
            "cpu")
                if [ $# -eq 0 ]; then
                    echo -e "${RED}‚ùå –£–∫–∞–∂–∏—Ç–µ –ª–∏–º–∏—Ç CPU!${NC}"
                    echo -e "${YELLOW}üí° –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: $container_name config cpu 1.0${NC}"
                    exit 1
                fi
                
                local value="$1"
                shift
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–∞—Ç CPU
                if ! [[ "$value" =~ ^[0-9]+\.?[0-9]*$ ]]; then
                    echo -e "${RED}‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç CPU!${NC}"
                    echo -e "${YELLOW}üí° –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: 0.5, 1.0, 2.0${NC}"
                    exit 1
                fi
                
                update_config_cache "cpu_limit" "$value"  # –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –∫—ç—à–µ
                echo -e "${GREEN}‚úÖ –õ–∏–º–∏—Ç CPU —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: $value${NC}"
                ;;
                
            "reset")
                update_config_cache "memory_limit" "$DEFAULT_MEMORY_LIMIT"  # –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∫ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏—è–º
                update_config_cache "cpu_limit" "$DEFAULT_CPU_LIMIT"
                echo -e "${GREEN}‚úÖ –í—Å–µ –ª–∏–º–∏—Ç—ã —Å–±—Ä–æ—à–µ–Ω—ã –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é${NC}"
                ;;
                
            *)
                echo -e "${RED}‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä: $param${NC}"
                echo -e "${YELLOW}üí° –î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: memory, cpu, reset${NC}"
                echo -e "${YELLOW}üí° –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: $container_name config [memory|cpu|reset] [–∑–Ω–∞—á–µ–Ω–∏–µ]${NC}"
                exit 1
                ;;
        esac
    done
    
    echo -e "${YELLOW}üîÑ –î–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω–∏—Ç–µ: $container_name restart${NC}"
}

# –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ–π –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
emergency_stop() {
    echo -e "${RED}üíÄ KILL ALL DOCKER${NC}"
    echo -e "${YELLOW}‚ö†Ô∏è –£–±–∏–≤–∞—é –í–°–ï Docker –ø—Ä–æ—Ü–µ—Å—Å—ã!${NC}"
    echo ""
    
    # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
    echo -e "${YELLOW}üõë –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã...${NC}"
    docker stop $(docker ps -q) 2>/dev/null || echo "–ù–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤"
    
    # –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
    echo -e "${YELLOW}üóë –£–¥–∞–ª—è—é –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã...${NC}"
    docker rm $(docker ps -aq) 2>/dev/null || echo "–ù–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤"
    
    # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Docker —Å–µ—Ä–≤–∏—Å
    echo -e "${YELLOW}‚èπ –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é Docker...${NC}"
    sudo systemctl stop docker 2>/dev/null || echo "Docker –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
    
    # –£–±–∏—Ç—å –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã Docker
    echo -e "${YELLOW}üíÄ –£–±–∏–≤–∞—é –ø—Ä–æ—Ü–µ—Å—Å—ã...${NC}"
    sudo pkill -f docker 2>/dev/null || echo "–ù–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å–æ–≤"
    
    echo -e "${GREEN}‚úÖ –í–°–ï –£–ë–ò–¢–û!${NC}"
    echo -e "${YELLOW}üí° –ó–∞–ø—É—Å–∫: sudo systemctl start docker${NC}"
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–∞–Ω–¥
show_available_commands() {
    local prefix="${1:-}"  # –ü—Ä–µ—Ñ–∏–∫—Å –∫–æ–º–∞–Ω–¥—ã (–ø—É—Å—Ç–æ–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
    prefix="${prefix:+$prefix }"  # –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ–±–µ–ª —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø—Ä–µ—Ñ–∏–∫—Å –µ—Å—Ç—å
    
    echo "  ${prefix}install         ${prefix:+# }–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã"
    echo "  ${prefix}start           ${prefix:+# }–ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å —Ç–µ–∫—É—â–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏"
    echo "  ${prefix}stop            ${prefix:+# }–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä"
    echo "  ${prefix}restart         ${prefix:+# }–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä"
    echo "  ${prefix}app-start       ${prefix:+# }–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ"
    echo "  ${prefix}app-stop        ${prefix:+# }–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ"
    echo "  ${prefix}app-restart     ${prefix:+# }–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ"
    echo "  ${prefix}app-update      ${prefix:+# }–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"
    echo "  ${prefix}app-db          ${prefix:+# }–†–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö"
    echo "  ${prefix}app-logs [N]    ${prefix:+# }–ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (—Ñ–∞–π–ª, N —Å—Ç—Ä–æ–∫)"
    echo "  ${prefix}logs            ${prefix:+# }–ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞"
    echo "  ${prefix}status          ${prefix:+# }–ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞"
    echo "  ${prefix}shell           ${prefix:+# }–ó–∞–ø—É—Å—Ç–∏—Ç—å shell –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ"
    echo "  ${prefix}kill            ${prefix:+# }üíÄ –£–±–∏—Ç—å –í–°–ï Docker –ø—Ä–æ—Ü–µ—Å—Å—ã"
    echo ""
    echo "–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:"
    echo "  ${prefix}config show     ${prefix:+# }–ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏"
    echo "  ${prefix}config memory   ${prefix:+# }–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ª–∏–º–∏—Ç –ø–∞–º—è—Ç–∏ (512m, 1g)"
    echo "  ${prefix}config cpu      ${prefix:+# }–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ª–∏–º–∏—Ç CPU (0.5, 1.0)"
    echo "  ${prefix}config reset    ${prefix:+# }–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –ª–∏–º–∏—Ç—ã –∫ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º"
    echo "  ${prefix}help            ${prefix:+# }–ü–æ–∫–∞–∑–∞—Ç—å —ç—Ç—É —Å–ø—Ä–∞–≤–∫—É"
}

# –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —Å–ø—Ä–∞–≤–∫–∏
show_help() {
    local container_name=$(get_container_name)
    echo -e "${BLUE}$(get_command_description)${NC}"
    echo ""
    echo "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: $container_name [–∫–æ–º–∞–Ω–¥–∞] [–ø–∞—Ä–∞–º–µ—Ç—Ä—ã]"
    echo ""
    echo "–ö–æ–º–∞–Ω–¥—ã:"
    show_available_commands
    echo ""
    echo "–ü—Ä–∏–º–µ—Ä—ã:"
    echo "  $container_name start                             # –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä"
    echo "  $container_name restart                           # –ü—Ä–∏–º–µ–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏"
    echo "  $container_name app-start                         # –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"
    echo "  $container_name app-logs 50                       # –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (50 —Å—Ç—Ä–æ–∫)"
    echo "  $container_name app-db --all --migrate            # –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î"
    echo "  $container_name config cpu 1.0                    # –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ª–∏–º–∏—Ç CPU"
    echo "  $container_name config memory 512m cpu 0.5        # –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–±–∞ –ª–∏–º–∏—Ç–∞"
    echo "  $container_name config reset                      # –°–±—Ä–æ—Å–∏—Ç—å –ª–∏–º–∏—Ç—ã"

}

# –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
main() {
    # –ù–∏–∫–∞–∫–∏—Ö —Ä—É—á–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –Ω–µ –Ω—É–∂–Ω–æ!
    
    # –î–ª—è –∫–æ–º–∞–Ω–¥—ã install –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º Docker
    if [ "$1" = "install" ]; then
        install_commands "$2"  # –ü–µ—Ä–µ–¥–∞–µ–º –≤—Ç–æ—Ä–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä –∫–∞–∫ –∏–º—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
        exit 0
    fi
    
    # –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–∑ —Ñ–∞–π–ª–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å)
    load_config_from_file
    
    # –î–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ –ø—Ä–æ–≤–µ—Ä—è–µ–º Docker
    check_docker
    
    case "${1:-help}" in
        start)
            start_service
            ;;
        stop)
            stop_service
            ;;
        restart)
            restart_service
            ;;
        app-start)
            start_app
            ;;
        app-stop)
            stop_app
            ;;
        app-restart)
            restart_app
            ;;
        app-logs)
            show_app_logs "$2"
            ;;
        logs)
            show_logs
            ;;
        status)
            show_status
            ;;
        app-db)
            manage_app_database "$@"
            ;;
        shell)
            open_shell
            ;;
        app-update)
            update_app
            ;;
        kill)
            emergency_stop
            ;;
        # –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
        config)
            if [ "$2" = "show" ]; then
                show_config
            else
                set_container_config "$@"
            fi
            ;;
        help|--help|-h)
            show_help
            ;;
        *)
            echo -e "${RED}‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞: $1${NC}"
            echo ""
            show_help
            exit 1
            ;;
    esac
}

# –ó–∞–ø—É—Å–∫
main "$@"
