name: "users_repository"
description: "Репозиторий для работы с таблицей Users (пользователи бота)."
table:
  name: "users"
  description: "База пользователей бота"
  fields:
    user_id:
      type: "INTEGER PRIMARY KEY"
      description: "Telegram user_id пользователя"
    username:
      type: "TEXT NULL"
      description: "Логин пользователя"
    first_name:
      type: "TEXT NULL"
      description: "Имя пользователя"
    last_name:
      type: "TEXT NULL"
      description: "Фамилия пользователя"
    is_bot:
      type: "INTEGER DEFAULT 0"
      description: "Флаг бота (0/1)"
    created_at:
      type: "TEXT NOT NULL"
      description: "Дата регистрации"
    updated_at:
      type: "TEXT NOT NULL"
      description: "Дата обновления"
    last_activity:
      type: "TEXT NULL"
      description: "Последняя активность"
  indexes: []
interface:
  methods:
    get_user_by_id:
      description: "Получает пользователя по user_id"
      input:
        user_id:
          type: integer
          description: "Telegram user_id пользователя"
      output:
        type: object
        description: "Словарь с данными пользователя или None"
    get_user_by_username:
      description: "Получает пользователя по username (без учета регистра)"
      input:
        username:
          type: string
          description: "Username пользователя"
      output:
        type: object
        description: "Словарь с данными пользователя или None"
    add_user:
      description: "Добавляет нового пользователя"
      input:
        fields:
          type: object
          description: "Универсальный словарь полей для создания пользователя"
      output:
        type: integer
        description: "ID созданного пользователя"
    add_or_update:
      description: "Добавляет или обновляет пользователя"
      input:
        user_id:
          type: integer
          description: "ID пользователя для операции"
        fields:
          type: object
          description: "Универсальный словарь полей для пользователя"
      output:
        type: boolean
        description: "Успех операции"
    update_user:
      description: "Обновляет пользователя по user_id"
      input:
        user_id:
          type: integer
          description: "ID пользователя для обновления"
        fields:
          type: object
          description: "Универсальный словарь полей для обновления"
      output:
        type: boolean
        description: "Успех операции"
    update_user_with_protection:
      description: "Обновляет пользователя с защитой от затирания важных полей (username, first_name, last_name, is_bot)"
      input:
        user_id:
          type: integer
          description: "ID пользователя для обновления"
        existing_user_data:
          type: object|null
          description: "Опциональные данные пользователя для оптимизации (избегает повторного запроса к БД)"
        fields:
          type: object
          description: "Универсальный словарь полей для обновления"
      output:
        type: boolean
        description: "Успех операции"